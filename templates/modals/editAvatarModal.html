<!-- 编辑头像模态框 -->
<div class="modal fade" id="avatarModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-camera me-2"></i>更新头像</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <!-- 模态框主体 -->
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12 text-center mb-3">
            <div id="avatarPreview">
              {% if user.avatar_path %}
                <img src="{{ url_for('auth.user_avatar', filename=user.avatar_path) }}" alt="头像预览" style="width: 100%; height: 100%; object-fit: cover" />
              {% else %}
                <i class="fas fa-user" style="font-size: 4rem; color: #ccc; line-height: 120px"></i>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="mb-3">
          <div class="input-group">
            <span id="avatarFileName" class="form-control text-muted">未选择文件</span>
            <input type="file" id="avatarUpload" accept="image/*" style="display: none" />
            <button class="btn btn-outline-primary" type="button" id="customAvatarUploadBtn">
              <i class="fas fa-folder-open me-1"></i>
              选择头像
            </button>
          </div>
          <div class="form-text">
            <i class="fas fa-info-circle me-1"></i>
            支持 JPG、PNG 格式，建议图片规格小于 200KB
          </div>
        </div>
        <div id="cropperContainer" style="display: none; max-height: 300px; overflow: hidden" class="mb-3"></div>
        <input type="hidden" id="croppedAvatarData" />
      </div>
      <!-- 模态框底部 -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="button" class="btn btn-secondary" id="cancelCropBtn">清空</button>
        <button type="button" class="btn btn-primary" id="cropAvatarBtn">裁剪</button>
        <button type="button" class="btn btn-success" id="saveAvatarBtn"><i class="fas fa-save me-1"></i>更新</button>
      </div>
    </div>
  </div>
</div>
