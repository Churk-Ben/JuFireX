import{m as Z,at as Q,r as i,n as A,o as X,aR as d,aJ as o,aK as t,aG as r,ay as e,aS as u,F as _,aT as F,j as h,aU as R,E as Y,aI as v}from"./vendor-rbLmP3-4.js";import{g as ee,a as le,b as ae,r as te}from"./players-DhwWMcom.js";import{u as E,n as y,q as oe,r as K,S,B,s as W,t as se,v as M,w as f,x as ne,y as re}from"./naive-ui-CJ7DtOcO.js";const ue={class:"container"},ie={class:"row g-3"},de={class:"col-6"},ve={class:"container flex-column mb-4"},ce={class:"row my-2"},me={class:"col-12 mb-2"},pe={class:"col-12"},he={key:0},fe={class:"text-truncate"},ye={class:"row my-2"},_e={class:"col-12 mb-2"},be={class:"col-12"},we={key:0},ge={class:"row my-2"},xe={class:"col-12 mb-2"},ke={class:"col-12"},Ce={key:0},Ne={class:"container"},Pe={class:"row g-2"},Ue={class:"col-12"},ze={class:"me-2 my-3",style:{"font-weight":"bold"}},Ie={class:"col-12"},Fe={class:"col-12"},Re={class:"col-12"},Se={class:"col-12"},Be={class:"col-12"},Me={class:"col-12"},Te={class:"col-12"},Ve={class:"col-12"},je={class:"col-12"},Le=Z({__name:"RoleManager",setup(Ae){const{t:s}=Q(),T=i(!0),m=i({human:[],online:[],local:[]}),k=i([]),z=i(!1);E();const $=n=>{const{type:a}=n;return Y(re,{closable:n.closable,onClose:n.onClose,type:a==="loading"?"default":a,title:s("online.lobbyTitle"),style:{width:"300px",maxWidth:"calc(100vw - 32px)",backdropFilter:"blur(10px)"}},{default:()=>n.content})},{info:Ee,success:Ke,warning:We,error:q}=E();function V(n){q(n,{render:$,closable:!0})}const C=i(!1),c=i("human"),p=i(""),b=i(""),w=i(""),g=i(""),x=i(""),N=i(""),P=i(""),G=A(()=>k.value.map(n=>({label:n.name,value:n.id})));function L(n){var a;return((a=k.value.find(l=>l.id===n))==null?void 0:a.name)||n}async function D(){if(H(),C.value=!0,!k.value.length){z.value=!0;try{k.value=await le()}catch{V("Failed to load providers")}finally{z.value=!1}}}function j(){C.value=!1}function H(){c.value="human",p.value="",b.value="",w.value="",g.value="",x.value="",N.value="",P.value=""}const J=A(()=>{if(c.value==="human")return!!p.value.trim();if(c.value==="online")return!!p.value.trim()&&!!b.value&&!!w.value.trim()&&!!g.value.trim();if(c.value==="local"){const n=x.value.trim(),a=/^[a-zA-Z]:[\\/]/.test(n)||n.startsWith("/");return!!p.value.trim()&&a}return!1});async function O(){let n;const a={name:p.value.trim()};switch(c.value){case"human":n={...a,type:"human",prefixPrompt:N.value};break;case"online":n={...a,type:"online",providerId:b.value,model:w.value.trim(),apiKey:g.value.trim()};break;case"local":n={...a,type:"local",modelPath:x.value.trim(),parameters:P.value.trim()};break;default:V("Invalid create type");return}const l=await ae(c.value,n);l&&m.value[c.value].push(l),j()}async function I(n){if(await te(n))for(const l in m.value)m.value[l]=m.value[l].filter(U=>U.uuid!==n)}return X(async()=>{try{m.value=await ee()}finally{T.value=!1}}),(n,a)=>(v(),d("div",ue,[o("div",ie,[o("div",de,[t(e(y),{embedded:"",title:e(s)("role.manager.title")},{"header-extra":r(()=>[t(e(B),{type:"primary",onClick:D},{default:r(()=>[h(u(e(s)("role.addRole")),1)]),_:1})]),default:r(()=>[t(e(K),{show:T.value},{default:r(()=>[o("div",ve,[o("section",ce,[o("div",me,[o("strong",null,u(e(s)("role.sections.human")),1)]),o("div",pe,[t(e(S),{style:{"max-height":"20vh"}},{default:r(()=>[m.value.human.length===0?(v(),d("div",he,[t(e(y),{size:"small",title:e(s)("role.empty")},null,8,["title"])])):(v(!0),d(_,{key:1},F(m.value.human,l=>(v(),d("div",{key:l.uuid},[t(e(y),{closable:"",class:"mb-1",size:"small",title:l.name,onClose:U=>I(l.uuid)},{default:r(()=>[o("div",fe,u(l.prefixPrompt),1)]),_:2},1032,["title","onClose"])]))),128))]),_:1})])]),o("section",ye,[o("div",_e,[o("strong",null,u(e(s)("role.modal.type.online")),1)]),o("div",be,[t(e(S),{style:{"max-height":"20vh"}},{default:r(()=>[m.value.online.length===0?(v(),d("div",we,[t(e(y),{size:"small",title:e(s)("role.empty")},null,8,["title"])])):(v(!0),d(_,{key:1},F(m.value.online,l=>(v(),d("div",{key:l.uuid},[t(e(y),{closable:"",class:"mb-1",size:"small",title:l.name,onClose:U=>I(l.uuid)},{default:r(()=>[h(u(L(l.providerId))+" - "+u(l.model),1)]),_:2},1032,["title","onClose"])]))),128))]),_:1})])]),o("section",ge,[o("div",xe,[o("strong",null,u(e(s)("role.modal.type.local")),1)]),o("div",ke,[t(e(S),{style:{"max-height":"20vh"}},{default:r(()=>[m.value.local.length===0?(v(),d("div",Ce,[t(e(y),{size:"small",title:e(s)("role.empty")},null,8,["title"])])):(v(!0),d(_,{key:1},F(m.value.local,l=>(v(),d("div",{key:l.uuid},[t(e(y),{closable:"",class:"mb-1",size:"small",title:l.name,onClose:U=>I(l.uuid)},{default:r(()=>[h(u(l.modelPath),1)]),_:2},1032,["title","onClose"])]))),128))]),_:1})])])])]),_:1},8,["show"])]),_:1},8,["title"]),t(e(oe),{show:C.value,"onUpdate:show":a[10]||(a[10]=l=>C.value=l),preset:"card","transform-origin":"center",title:e(s)("role.modal.title"),style:{width:"640px",maxWidth:"80vw",minHeight:"400px"}},{footer:r(()=>[t(e(W),{justify:"end"},{default:r(()=>[t(e(B),{quaternary:"",onClick:j},{default:r(()=>[h(u(e(s)("role.modal.actions.cancel")),1)]),_:1}),t(e(B),{type:"primary",disabled:!J.value,onClick:O},{default:r(()=>[h(u(e(s)("role.modal.actions.create")),1)]),_:1},8,["disabled"])]),_:1})]),default:r(()=>[o("div",Ne,[t(e(K),{show:z.value},{default:r(()=>[o("div",Pe,[o("div",Ue,[t(e(W),{justify:"space-between"},{default:r(()=>[o("label",ze,u(e(s)("role.modal.type.label")),1),t(e(se),{class:"mx-2 my-3",value:c.value,"onUpdate:value":a[0]||(a[0]=l=>c.value=l)},{default:r(()=>[t(e(M),{value:"human"},{default:r(()=>[h(u(e(s)("role.modal.type.human")),1)]),_:1}),t(e(M),{value:"online"},{default:r(()=>[h(u(e(s)("role.modal.type.online")),1)]),_:1}),t(e(M),{value:"local"},{default:r(()=>[h(u(e(s)("role.modal.type.local")),1)]),_:1})]),_:1},8,["value"])]),_:1})]),c.value==="human"?(v(),d(_,{key:0},[o("div",Ie,[t(e(f),{value:p.value,"onUpdate:value":a[1]||(a[1]=l=>p.value=l),placeholder:e(s)("role.modal.fields.roleName")},null,8,["value","placeholder"])]),o("div",Fe,[t(e(f),{value:N.value,"onUpdate:value":a[2]||(a[2]=l=>N.value=l),type:"textarea",placeholder:e(s)("role.modal.fields.prefixPrompt"),rows:"5"},null,8,["value","placeholder"])])],64)):R("",!0),c.value==="online"?(v(),d(_,{key:1},[o("div",Re,[t(e(f),{value:p.value,"onUpdate:value":a[3]||(a[3]=l=>p.value=l),placeholder:e(s)("role.modal.fields.roleName")},null,8,["value","placeholder"])]),o("div",Se,[t(e(ne),{value:b.value,"onUpdate:value":a[4]||(a[4]=l=>b.value=l),options:G.value,placeholder:e(s)("role.modal.fields.provider")},null,8,["value","options","placeholder"])]),o("div",Be,[t(e(f),{value:w.value,"onUpdate:value":a[5]||(a[5]=l=>w.value=l),placeholder:e(s)("role.modal.fields.modelName")},null,8,["value","placeholder"])]),o("div",Me,[t(e(f),{value:g.value,"onUpdate:value":a[6]||(a[6]=l=>g.value=l),placeholder:e(s)("role.modal.fields.api"),type:"password"},null,8,["value","placeholder"])])],64)):R("",!0),c.value==="local"?(v(),d(_,{key:2},[o("div",Te,[t(e(f),{value:p.value,"onUpdate:value":a[7]||(a[7]=l=>p.value=l),placeholder:e(s)("role.modal.fields.roleName")},null,8,["value","placeholder"])]),o("div",Ve,[t(e(f),{value:x.value,"onUpdate:value":a[8]||(a[8]=l=>x.value=l),placeholder:e(s)("role.modal.fields.localPath")},null,8,["value","placeholder"])]),o("div",je,[t(e(f),{value:P.value,"onUpdate:value":a[9]||(a[9]=l=>P.value=l),type:"textarea",placeholder:e(s)("role.modal.fields.parameters"),rows:"3"},null,8,["value","placeholder"])])],64)):R("",!0)])]),_:1},8,["show"])])]),_:1},8,["show","title"])])])]))}});export{Le as default};
