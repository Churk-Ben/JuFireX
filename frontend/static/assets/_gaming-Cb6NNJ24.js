import{m as W,at as K,au as q,r as c,aV as $,o as Q,i as X,ag as Y,aR as f,aJ as v,aK as s,aG as a,ay as t,aW as Z,E as ee,j as i,aS as l,F as V,aT as A,aU as ae,W as te,aI as u,ax as F}from"./vendor-rbLmP3-4.js";import{j as se,l as ne,s as oe}from"./games-DiErDNnP.js";import{u as le,n as C,S as L,w as re,B as ie,y as ce,D as ue,E as de,F as P,o as me,G as U,H as j,I as D}from"./naive-ui-CJ7DtOcO.js";import{_ as fe}from"./index--1QGoQ3i.js";const pe={class:"gaming-page"},ve={class:"gaming-left-column"},ge={class:"message-container"},he={style:{"font-size":"12px",opacity:"0.8"}},_e={class:"input-container gap-2 mb-1"},ye={class:"gaming-right-column"},be={key:0},Ie={key:1},ke={key:0,style:{padding:"16px"}},xe=W({__name:"_gaming",setup(Ne){const{t:x}=K(),N=q(),r=X("socket"),T=N.params.id,g=N.query.gameId,h=N.query.playerIds,d=c({name:"游戏标题",status:"等待连接",statusType:"info"}),_=c([]),B=c([]),m=c(""),w=c(null),z=c(!0),E=e=>{const n=e.target;z.value=n.scrollHeight-(n.scrollTop+n.clientHeight)<=50},y=e=>{const{type:n}=e;return ee(ce,{closable:e.closable,onClose:e.onClose,type:n==="loading"?"default":n,title:"游戏通知",style:{width:"300px",maxWidth:"calc(100vw - 32px)",backdropFilter:"blur(10px)"}},{default:()=>e.content})},b=le(),H=e=>b.info(e,{render:y,closable:!0}),J=e=>b.success(e,{render:y,closable:!0}),R=e=>b.warning(e,{render:y,closable:!0}),I=e=>b.error(e,{render:y,closable:!0}),S=c(!1);let p=null;$(()=>S.value?!0:(R("切换页面将不会为你保存游戏进度, 通知消失前再次点击以切换页面"),S.value=!0,p&&clearTimeout(p),p=setTimeout(()=>{S.value=!1},3e3),!1));const k=c([]);function O(e){const n=k.value.indexOf(e.id);n>-1?k.value.splice(n,1):k.value.push(e.id)}Q(()=>{if(!r){I("Socket未连接");return}if(se(r,{onInfo:e=>{e.name!==void 0&&(d.value.name=e.name),e.status!==void 0&&(d.value.status=e.status),e.statusType!==void 0&&(d.value.statusType=e.statusType)},onPlayers:e=>{_.value=e},onMessage:async e=>{console.log("Received message:",e);const n=z.value;B.value.push(e),n&&(await te(),w.value&&w.value.scrollTo({top:99999,behavior:"smooth"}))},onNotification:e=>{switch(e.type){case"success":J(e.content);break;case"warning":R(e.content);break;case"error":I(e.content);break;default:H(e.content)}}}),g&&h)try{const e=JSON.parse(h);r.emit("app:initGame",{gameId:g,playerIds:e,sessionId:T})}catch(e){I("处理玩家ID时出错: "+e)}}),Y(()=>{if(p&&clearTimeout(p),r){if(g&&h)try{r.emit("game:leave",{gameId:g,playerIds:JSON.parse(h),sessionId:T})}catch(e){console.error("Failed to parse playerIds on leave:",e)}ne(r)}});function G(){m.value.trim()&&(r&&r.connected?(oe(r,_.value.find(e=>e.type==="human"),m.value,T),m.value=""):I("无法发送消息: Socket未连接"))}return(e,n)=>(u(),f("div",pe,[v("div",ve,[s(t(C),{size:"small"},{default:a(()=>[s(t(ue),null,{title:a(()=>[i(l(d.value.name),1)]),extra:a(()=>[s(t(de),{type:d.value.statusType||"default"},{default:a(()=>[i(l(d.value.status),1)]),_:1},8,["type"])]),_:1})]),_:1}),v("div",ge,[s(t(L),{ref_key:"scrollbarRef",ref:w,id:"message-scrollbar",onScroll:E},{default:a(()=>[s(t(P),{class:"chat-list"},{default:a(()=>[(u(!0),f(V,null,A(B.value,(o,M)=>(u(),F(t(U),{key:M,class:"chat-item"},{default:a(()=>[s(t(j),{"content-indented":""},{avatar:a(()=>[s(t(D),{round:"",size:"small"},{default:a(()=>[i(l(o.sender.name.charAt(0).toUpperCase()),1)]),_:2},1024)]),header:a(()=>[i(l(o.sender.name),1)]),"header-extra":a(()=>[v("span",he,l(o.time),1)]),default:a(()=>[i(" "+l(o.content),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},512)]),v("div",_e,[s(t(re),{value:m.value,"onUpdate:value":n[0]||(n[0]=o=>m.value=o),size:"large",type:"text",placeholder:t(x)("game.chat.inputPlaceholder"),onKeyup:Z(G,["enter"])},null,8,["value","placeholder"]),s(t(ie),{type:"primary",size:"large",onClick:G,disabled:!m.value.trim()},{default:a(()=>[i(l(t(x)("game.chat.send")),1)]),_:1},8,["disabled"])])]),v("div",ye,[s(t(C),{title:t(x)("game.players"),style:{height:"100%"},"content-style":"padding: 0; overflow-y: auto;","header-style":"padding: 16px; border-bottom: 1px solid var(--n-border-color);"},{default:a(()=>[s(t(L),null,{default:a(()=>[s(t(P),{hoverable:"",clickable:""},{default:a(()=>[(u(!0),f(V,null,A(_.value,o=>(u(),F(t(U),{key:o.id,onClick:M=>O(o)},{default:a(()=>[s(t(j),null,{avatar:a(()=>[s(t(D),{round:"",size:"small"},{default:a(()=>[i(l(o.name.charAt(0).toUpperCase()),1)]),_:2},1024)]),header:a(()=>[i(l(o.name),1)]),"header-extra":a(()=>[i(l(o.type),1)]),description:a(()=>[k.value.includes(o.id)?(u(),f("div",be,l(JSON.stringify(o.data||{},null,2)),1)):(u(),f("span",Ie,"点按查看玩家数据"))]),_:2},1024)]),_:2},1032,["onClick"]))),128)),_.value.length===0?(u(),f("div",ke,[s(t(C),{embedded:""},{default:a(()=>[s(t(me),{status:"info",title:"等待玩家",description:"暂无玩家加入",size:"small"})]),_:1})])):ae("",!0)]),_:1})]),_:1})]),_:1},8,["title"])])]))}}),Be=fe(xe,[["__scopeId","data-v-c3daae17"]]);export{Be as default};
