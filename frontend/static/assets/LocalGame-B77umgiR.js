import{m as G,at as L,r as c,n as v,o as O,aR as b,aJ as s,aU as U,aK as i,aG as p,ay as o,aS as _,j as V,E as K,aH as j,i as D,aI as k}from"./vendor-rbLmP3-4.js";import{g as E}from"./players-DhwWMcom.js";import{g as J}from"./games-DiErDNnP.js";import{n as M,r as R,x as q,A,B as F,C as H}from"./naive-ui-CJ7DtOcO.js";const W={class:"container"},$={class:"row g-3"},z={key:0,class:"col-12 col-md-8"},Q={class:"container flex-column mb-4"},X={class:"row my-2"},Y={class:"col-12 mb-2"},Z={class:"col-12"},ee={class:"row my-2"},ae={class:"col-12 mb-2"},le={class:"col-12"},ce=G({__name:"LocalGame",setup(te){const{t:n}=L(),N=j(),w=D("socket"),x=c(!1),h=c(!1),d=c(""),f=c(!0),g=c([]),u=c([]),m=c({human:[],online:[],local:[]}),y=v(()=>{const a=m.value.human.map(l=>({label:l.name,value:l.uuid})),e=m.value.online.map(l=>({label:l.name,value:l.uuid})),t=m.value.local.map(l=>({label:l.name,value:l.uuid}));return[{label:n("role.modal.type.human"),value:"__group_human",children:a},{label:n("role.modal.type.online"),value:"__group_online",children:e},{label:n("role.modal.type.local"),value:"__group_local",children:t}]});function C(a){const e=[];function t(l=[]){for(const r of l)r.children&&r.children.length?t(r.children):e.push({label:r.label,value:r.value})}return t(a),e.length?e:[{label:n("role.empty"),value:"__empty"}]}const S=v(()=>C(y.value)),I=({onCheck:a,pattern:e})=>K(H,{style:"margin: 0 4px;",keyField:"value",checkable:!0,selectable:!1,blockLine:!0,checkOnClick:!0,cascade:!0,data:y.value,pattern:e,checkedKeys:u.value,onUpdateCheckedKeys:t=>{const l=t.filter(r=>!r.startsWith("__group_"));a(l)}}),B=v(()=>!!d.value&&u.value.length>=2),P=v(()=>g.value.map(a=>({label:a,value:a})));function T(){if(w){x.value=!0;const a=Math.random().toString(36).substring(2,6);N.push({path:`/gaming/${a}`,query:{gameId:d.value,playerIds:JSON.stringify(u.value)}}),h.value=!0}else console.error("socket 未连接")}return O(async()=>{try{const[a,e]=await Promise.all([J(),E()]);g.value=a,m.value=e}finally{f.value=!1}}),(a,e)=>(k(),b("div",W,[s("div",$,[h.value?U("",!0):(k(),b("div",z,[i(o(M),{embedded:"",title:o(n)("local.configTitle")},{"header-extra":p(()=>[i(o(F),{type:"primary",disabled:!B.value,onClick:T},{default:p(()=>[V(_(o(n)("local.startButton")),1)]),_:1},8,["disabled"])]),default:p(()=>[i(o(R),{show:f.value},{default:p(()=>[s("div",Q,[s("section",X,[s("div",Y,[s("strong",null,_(o(n)("local.selectGameTitle")),1)]),s("div",Z,[i(o(q),{value:d.value,"onUpdate:value":e[0]||(e[0]=t=>d.value=t),options:P.value,placeholder:o(n)("local.selectPlaceholder")},null,8,["value","options","placeholder"])])]),s("section",ee,[s("div",ae,[s("strong",null,_(o(n)("local.selectPlayersTitle")),1)]),s("div",le,[i(o(A),{value:u.value,"onUpdate:value":e[1]||(e[1]=t=>u.value=t),options:S.value,"render-source-list":I,"source-filterable":"","target-filterable":""},null,8,["value","options"])])])])]),_:1},8,["show"])]),_:1},8,["title"])]))])]))}});export{ce as default};
